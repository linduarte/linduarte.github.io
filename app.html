<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Entrando...</title>
  <script>
    // Client-side token validation: parse a JWT in localStorage.access_token and check `exp` claim.
    (function () {
      function base64UrlDecode(input) {
        // Replace url-safe chars and add padding
        input = input.replace(/-/g, '+').replace(/_/g, '/');
        const pad = input.length % 4;
        if (pad === 2) input += '==';
        else if (pad === 3) input += '=';
        else if (pad !== 0) return null;
        try {
          return decodeURIComponent(escape(atob(input)));
        } catch (e) {
          try {
            return atob(input);
          } catch (e2) {
            return null;
          }
        }
      }

      function parseJwt(token) {
        if (!token) return null;
        const parts = token.split('.');
        if (parts.length < 2) return null;
        const payload = base64UrlDecode(parts[1]);
        if (!payload) return null;
        try {
          return JSON.parse(payload);
        } catch (e) {
          return null;
        }
      }

      function isTokenValid(token) {
        const payload = parseJwt(token);
        if (!payload) return false;
        // If `exp` exists, check expiry (exp is seconds since epoch)
        if (payload.exp && typeof payload.exp === 'number') {
          const now = Math.floor(Date.now() / 1000);
          return payload.exp > now + 5; // 5s leeway
        }
        // No exp claim: consider it invalid (safer)
        return false;
      }

      try {
        const token = localStorage.getItem('access_token');
        if (token && isTokenValid(token)) {
          window.location.replace('/app/templates/git-course/1a-prefacio.html');
        } else {
          // Token is missing or expired -> ensure removal and go to landing
          localStorage.removeItem('access_token');
          window.location.replace('/landing.html');
        }
      } catch (e) {
        try { localStorage.removeItem('access_token'); } catch (__) {}
        window.location.replace('/landing.html');
      }
    })();
  </script>
</head>
<body style="font-family: Arial, sans-serif; text-align: center; margin-top: 20vh;">
  <p>Entrando...</p>
  <p>
    Se n√£o redirecionar automaticamente:
    <a href="/landing.html">Landing</a> |
    <a href="/app/templates/git-course/login.html">Login</a>
  </p>
</body>
</html>
